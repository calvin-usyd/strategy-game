<!DOCTYPE html>
<!-- saved from url=(0043)http://getbootstrap.com/examples/dashboard/ -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="http://getbootstrap.com/favicon.ico">

    <title>SIMIT</title>

    <!-- Bootstrap core CSS -->
    <link href="http://quantumfi.com.au/stock-simulation/views/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
	<link rel="stylesheet" href="http://quantumfi.com.au/stock-simulation/views/css/main.css">
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="http://quantumfi.com.au/stock-simulation/views/js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="js/lt_IE9/html5shiv.min.js"></script>
      <script src="js/lt_IE9/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
	<div class="container">
		<div class="row">
			<h1 class="center-block text-center">Stock Simulation</h1>
		</div>
		<div class="row">
			<div class="col-lg-offset-4 col-lg-4 jumbotron">
				<label>Price per share: </label><input type="number" class="form-control" name="price" disabled=""/>
				<label>$ X: </label><input type="number" class="form-control" name="x" disabled=""/>
				<button class="btn btn-primary" id="send">Send</button>
			</div>
		</div>
		<div class="row">
			<div class="col-sm-12 col-md-4 col-md-offset-4 col-lg-offset-4 col-lg-4 well" id="player1">
				<h2 class="text-center">Player 1</h2>
				<div class="center-block text-center">
					<button class="btn btn-lg btn-success" id="buy">Buy</button>
					<button class="btn btn-lg btn-danger" id="sell">Sell</button>
				</div>
				<label>Cash: </label><input type="number" class="form-control" name="cash"/>
				<!--label>Shares: </label><input type="number" class="form-control" name="shares" disabled=""/>
				<label>Capital: </label><input type="number" class="form-control" name="capital" disabled=""/>
				<label>Rank: </label><input type="number" class="form-control" name="rank" disabled=""/-->
			</div>
			
			<div class="col-sm-12 col-md-4 col-md-offset-4 col-lg-offset-4 col-lg-4 well" id="history">
				<label class="mRound"></label><span class="mAction"></span>
			</div>
			
			<!--div class="col-sm-6 col-md-4 col-lg-4 well" id="player2">
				<h2 class="text-center">Player 2</h2>
				<div class="center-block text-center">
					<button class="btn btn-lg btn-success" id="buy">Buy</button>
					<button class="btn btn-lg btn-danger" id="sell">Sell</button>
				</div>
				<label>Cash: </label><input type="number" class="form-control" name="cash"/>
				<label>Shares: </label><input type="number" class="form-control" name="shares" disabled=""/>
				<label>Capital: </label><input type="number" class="form-control" name="capital" disabled=""/>
				<label>Rank: </label><input type="number" class="form-control" name="rank" disabled=""/>
			</div>
			
			<div class="col-sm-6 col-md-4 col-lg-4 well" id="player3">
				<h2 class="text-center">Player 3</h2>
				<div class="center-block text-center">
					<button class="btn btn-lg btn-success" id="buy">Buy</button>
					<button class="btn btn-lg btn-danger" id="sell">Sell</button>
				</div>
				<label>Cash: </label><input type="number" class="form-control" name="cash"/>
				<label>Shares: </label><input type="number" class="form-control" name="shares" disabled=""/>
				<label>Capital: </label><input type="number" class="form-control" name="capital" disabled=""/>
				<label>Rank: </label><input type="number" class="form-control" name="rank" disabled=""/>
			</div>
			
			<div class="col-sm-6 col-md-4 col-lg-4 well" id="player4">
				<h2 class="text-center">Player 4</h2>
				<div class="center-block text-center">
					<button class="btn btn-lg btn-success" id="buy">Buy</button>
					<button class="btn btn-lg btn-danger" id="sell">Sell</button>
				</div>
				<label>Cash: </label><input type="number" class="form-control" name="cash"/>
				<label>Shares: </label><input type="number" class="form-control" name="shares" disabled=""/>
				<label>Capital: </label><input type="number" class="form-control" name="capital" disabled=""/>
				<label>Rank: </label><input type="number" class="form-control" name="rank" disabled=""/>
			</div>
			
			<div class="col-sm-6 col-md-4 col-lg-4 well" id="player5">
				<h2 class="text-center">Player 5</h2>
				<div class="center-block text-center">
					<button class="btn btn-lg btn-success" id="buy">Buy</button>
					<button class="btn btn-lg btn-danger" id="sell">Sell</button>
				</div>
				<label>Cash: </label><input type="number" class="form-control" name="cash"/>
				<label>Shares: </label><input type="number" class="form-control" name="shares" disabled=""/>
				<label>Capital: </label><input type="number" class="form-control" name="capital" disabled=""/>
				<label>Rank: </label><input type="number" class="form-control" name="rank" disabled=""/>
			</div>
			
			<div class="col-sm-6 col-md-4 col-lg-4 well" id="player6">
				<h2 class="text-center">Player 6</h2>
				<div class="center-block text-center">
					<button class="btn btn-lg btn-success" id="buy">Buy</button>
					<button class="btn btn-lg btn-danger" id="sell">Sell</button>
				</div>
				<label>Cash: </label><input type="number" class="form-control" name="cash"/>
				<label>Shares: </label><input type="number" class="form-control" name="shares" disabled=""/>
				<label>Capital: </label><input type="number" class="form-control" name="capital" disabled=""/>
				<label>Rank: </label><input type="number" class="form-control" name="rank" disabled=""/>
			</div-->
		</div>
	</div>
  </body>
</html>

<script src="http://quantumfi.com.au/stock-simulation/views/js/jquery.min.js"></script>
<script src="http://quantumfi.com.au/stock-simulation/views/js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="http://quantumfi.com.au/stock-simulation/views/js/ie10-viewport-bug-workaround.js"></script>

<script>
//TODO: initial value should take from database for multiple player
var 
setting = {
	pricePerShare : 0.30
	,x : 100
	,numBuy : []
	,numSell : []
},
players = [
	player1 = {
		cash : 100
		,shares : 30
		,rank : 0
	},
	player2 = {
		cash : 100
		,shares : 20
		,rank : 0
	},
	player3 = {
		cash : 100
		,shares : 10
		,rank : 0
	},
	player4 = {
		cash : 100
		,shares : 20
		,rank : 0
	},
	player5 = {
		cash : 100
		,shares : 20
		,rank : 0
	},
	player6 = {
		cash : 100
		,shares : 20
		,rank : 0
	}
]
;
console.log(players);
$('input[name=price]').val(setting.pricePerShare);
$('input[name=x]').val(setting.x);
var player;

for (var p=0; p < players.length; p++){

	var capital = players[p].cash + setting.pricePerShare * players[p].shares;
	
	$('#player'+(p+1) + ' input[name=cash]').val(players[p].cash);
	$('#player'+(p+1) + ' input[name=shares]').val(players[p].shares);
	$('#player'+(p+1) + ' input[name=capital]').val(capital);
	$('#player'+(p+1) + ' input[name=rank]').val(players[p].rank);
}

init('#player1');
/*init('#player2');
init('#player3');
init('#player4');
init('#player5');
init('#player6');*/

function init(player){
	$(player+' #buy').bind('click', function(){
		setting.numBuy.push(setting.numBuy.length + 1);
		process(player, -setting.x);
	});

	$(player+' #sell').bind('click', function(){
		setting.numSell.push(setting.numSell.length + 1);
		process(player, setting.x);
	});
}

function process(player, xPrice){
	if (setting.numSell.length + setting.numBuy.length == players.length){
		var cash = parseFloat($(player + ' input[name=cash]').val());
		var shares = parseFloat($(player + ' input[name=shares]').val());
		
		cash = cash + xPrice;
		
		shares = (shares + xPrice / setting.pricePerShare).toFixed(2);
		//shares = (shares - xPrice / setting.pricePerShare).toFixed(2);
		
		capital = (cash + setting.pricePerShare * shares).toFixed(2);
		console.log(player);
		console.log(capital);
		setting.pricePerShare = setting.pricePerShare * ((players.length + setting.numBuy.length) / (players.length - setting.numSell.length) );
		
		$(player + ' input[name=cash]').val(cash);
		$(player + ' input[name=shares]').val(shares);
		$(player + ' input[name=capital]').val(capital);
		
		$('input[name=price]').val(setting.pricePerShare.toFixed(2));
	}
}

var conn = new WebSocket('ws://preps.quantumfi.com.au:8080');
conn.onopen = function(e) {
    console.log("Connection established!");
};

conn.onmessage = function(e) {
    console.log(e.data);
};
$('#send').bind('click', function(){
	conn.send('Hello World!');
});
</script>